#!/bin/bash
EXE_NAME=gcc
function _agcc-msg { echo "[$EXE_NAME-m32]" "$@" >&2; }
function _agcc-dbg { [[ $AGCC_DBG ]] && _agcc-msg "$@"; }

###############################################################################
#Search exe in $PATH, but exclude myself.
#This is faster than using `which -a $EXE_NAME` then filter

EXE_PATH=""

#split $PATH by :, save it to pathList as array
IFS=: pathList=($PATH); unset IFS

foundMyself=""
for d in "${pathList[@]}"; do
    #if exe in the dir and not same as me, then that is the real path i want
    if [[ -f $d/$EXE_NAME ]]; then
        if [[ $d/$EXE_NAME -ef "$0" ]]; then
            foundMyself=YES
        else
            if [[ $foundMyself ]]; then
                EXE_PATH=$d/$EXE_NAME
                break
            fi
        fi
    fi
done

if [[ ! $EXE_PATH ]]; then
    _agcc-msg "$EXE_NAME not found."
    exit 1
fi

###############################################################################
#if already have -m32 option then run command without change.

for arg in "$@"; do
    if [[ $arg == -m32 ]]; then
        _agcc-dbg "call \"$EXE_PATH\" (already specified -m32 option)"
        exec "$EXE_PATH" "$@"
        exit
    fi
done

###############################################################################
#otherwise run command with -lpthread
_agcc-msg "call \"$EXE_PATH\" with -m32 option"
exec "$EXE_PATH" -m32 "$@"
